---
- name: Update lvm config
  ansible.builtin.replace:
     path: /etc/lvm/lvm.conf
     regexp: '^locking_type'
     replace: 'locking_type = 3'
  tags:
    - lvmconfig

- name: Create physical volume
  community.general.lvg:
  vg: ClusterDatavg
  pvs: /dev/sdb 


- name: Create a Logical volume uzmgwyw1datalv.
  community.general.lvol:
    vg: ClusterDatavg
    lv: uzmgwyw1datalv
    size: 30G

- name: Create a Logical volume uzmgwyw2datalv.
  community.general.lvol:
    vg: ClusterDatavg
    lv: uzmgwyw2datalv
    size: 30G

- name: Create a Logical volume uzmgwyw1loglv.
  community.general.lvol:
    vg: ClusterDatavg
    lv: uzmgwyw1loglv
    size: 30G

- name: Create a Logical volume uzmgwyw2loglv.
  community.general.lvol:
    vg: ClusterDatavg
    lv: uzmgwyw2loglv
    size: 30G

- name: Create a Logical volume uzmfte1datalv.
  community.general.lvol:
    vg: ClusterDatavg
    lv: uzmfte1datalv
    size: 30G

- name: Create a Logical volume uzmfte1loglv.
  community.general.lvol:
    vg: ClusterDatavg
    lv: uzmfte1loglv
    size: 30G

- name: Formatting the created logical volumes.
  ansible.builtin.shell: '{{ item }}'
  loop:
    - mkfs.gfs2 -j2 -p lock_dlm -t gpfscluster:uzmgwyw1datalv /dev/mapper/ClusterDatavg-uzmgwyw1datalv
    - mkfs.gfs2 -j2 -p lock_dlm -t gpfscluster:uzmgwyw2datalv /dev/mapper/ClusterDatavg-uzmgwyw2datalv
    - mkfs.gfs2 -j2 -p lock_dlm -t gpfscluster:uzmgwyw1loglv /dev/mapper/ClusterDatavg-uzmgwyw1loglv
    - mkfs.gfs2 -j2 -p lock_dlm -t gpfscluster:uzmgwyw2loglv /dev/mapper/ClusterDatavg-uzmgwyw2loglv
    - mkfs.gfs2 -j2 -p lock_dlm -t gpfscluster:uzmfte1datalv /dev/mapper/ClusterDatavg-uzmfte1datalv
    - mkfs.gfs2 -j2 -p lock_dlm -t gpfscluster:uzmfte1loglv /dev/mapper/ClusterDatavg-uzmfte1loglv


- name: Create resources.
  ansible.builtin.shell: '{{ item }}'
  loop:
    - pcs resource create uzmgwyw1dataclusterfs Filesystem device="/dev/ClusterDatavg/uzmgwyw1datalv" \
        directory="/gpfsgwy/uzmgwy1/mq/data" fstype="gfs2" "options=noatime" op monitor interval=10s on-fail=fence clone interleave=true
    - pcs resource create uzmgwyw2dataclusterfs Filesystem device="/dev/ClusterDatavg/uzmgwyw2datalv" \
        directory="/gpfsgwy/uzmgwy2/mq/data" fstype="gfs2" "options=noatime" op monitor interval=10s on-fail=fence clone interleave=true
    - pcs resource create uzmgwyw1logclusterfs Filesystem device="/dev/ClusterDatavg/uzmgwyw1loglv" \
        directory="/gpfsgwy/uzmgwy1/mq/log" fstype="gfs2" "options=noatime" op monitor interval=10s on-fail=fence clone interleave=true
    - pcs resource create uzmgwyw2logclusterfs Filesystem device="/dev/ClusterDatavg/uzmgwyw2loglv" \
        directory="/gpfsgwy/uzmgwy2/mq/log" fstype="gfs2" "options=noatime" op monitor interval=10s on-fail=fence clone interleave=true
    - pcs resource create uzmfte1dataclusterfs Filesystem device="/dev/ClusterDatavg/uzmfte1datalv" \
        directory="/gpfsgwy/uzmfte1/mq/data" fstype="gfs2" "options=noatime" op monitor interval=10s on-fail=fence clone interleave=true
    - pcs resource create uzmfte1logclusterfs Filesystem device="/dev/ClusterDatavg/uzmfte1loglv" \
        directory="/gpfsgwy/uzmfte1/mq/log" fstype="gfs2" "options=noatime" op monitor interval=10s on-fail=fence clone interleave=true
        


